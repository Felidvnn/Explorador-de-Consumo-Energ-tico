<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/L.Control.Locate.min.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet-search.css">
        <link rel="stylesheet" href="css/filter.css">
<link rel="stylesheet" href="css/nouislider.min.css">
        <link rel="stylesheet" href="css/leaflet-control-geocoder.Geocoder.css">
        <link rel="stylesheet" href="css/leaflet-measure.css">
        <style>
        
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }

        /* Estilo para el botón flotante*/
        .float-btn {
            position: absolute;
            bottom: 20px; /* Posición en la parte inferior */
            left: 20px;   /* Posición a la izquierda */
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 15px 25px; /* Ajuste de padding para hacerlo más rectangular */
            border-radius: 5px; /* Bordes ligeramente redondeados, si lo prefieres cuadrado usa border-radius: 0px; */
            font-size: 16px; /* Tamaño de fuente más pequeño si es necesario */
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 9999;
        }

        /* Estilo para el modal */
        .modal {
            display: none;
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            z-index: 9998;
        }

        .modal-content {
            background-color: #4CAF50;
            padding: 10px;
            width: 1500px; /* Ancho específico */
            height: 720px; /* Altura específica */
            overflow-y: hidden; /* Agrega desplazamiento vertical si el contenido es muy largo */
            margin: 0 auto;
            border-radius: 0px;
            z-index: 9997;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Botón de cerrar el modal */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            z-index: 9996;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Estilo para el iframe */
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .lightbox {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .lightbox-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 15px;
            width: 80%;
            height: 80%;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
        }

        .lightbox-content iframe {
            flex: 1;
            border: none;
        }

        .lightbox .close {
            color: black;
            font-size: 24px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
        }
        </style>
        <title>Explorador de Consumo</title>
    </head>
    <body>
        <div id="map">
        </div>
        <button class="float-btn" onclick="openCalculator()">Abrir Calculadora</button>
        <div id="calculatorLightbox" class="lightbox">
          <div class="lightbox-content">
              <span class="close" onclick="closeCalculator()">&times;</span>
              <iframe id="calculatorIframe" src="https://felidvnn.github.io/CalculadoraEnergetica/calculadora.html"></iframe>
          </div>
        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/L.Control.Locate.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet-control-geocoder.Geocoder.js"></script>
        <script src="js/leaflet-measure.js"></script>
        <script src="js/leaflet-search.js"></script>
        <script src="js/tailDT.js"></script>
<script src="js/nouislider.min.js"></script>
<script src="js/wNumb.js"></script>
        <script src="data/Simplificado_1.js"></script>
        <script>
        var highlightLayer;
        function highlightFeature(e) {
            highlightLayer = e.target;

            if (e.target.feature.geometry.type === 'LineString' || e.target.feature.geometry.type === 'MultiLineString') {
              highlightLayer.setStyle({
                color: '#ffff00',
              });
            } else {
              highlightLayer.setStyle({
                fillColor: '#ffff00',
                fillOpacity: 1
              });
            }
        }
        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:5
        }).fitBounds([[-33.72898542006454,-70.91139589739392],[-33.070914632220315,-70.09419628797734]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        // add class to format popup if it contains media
		function addClassToPopupIfMedia(content, popup) {
			var tempDiv = document.createElement('div');
			tempDiv.innerHTML = content;
			if (tempDiv.querySelector('td img')) {
				popup._contentNode.classList.add('media');
					// Delay to force the redraw
					setTimeout(function() {
						popup.update();
					}, 10);
			} else {
				popup._contentNode.classList.remove('media');
			}
		}
        var title = new L.Control({'position':'topleft'});
        title.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info');
            this.update();
            return this._div;
        };
        title.update = function () {
            this._div.innerHTML = '<h2>Explorador de Consumo</h2>';
        };
        title.addTo(map);
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        L.control.locate({locateOptions: {maxZoom: 19}}).addTo(map);
        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        map.createPane('pane_GoogleSatellite_0');
        map.getPane('pane_GoogleSatellite_0').style.zIndex = 400;
        var layer_GoogleSatellite_0 = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
            pane: 'pane_GoogleSatellite_0',
            opacity: 1.0,
            attribution: '<a href="https://www.google.at/permissions/geoguidelines/attr-guide.html">Map data ©2015 Google</a>',
            minZoom: 5,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 20
        });
        layer_GoogleSatellite_0;
        map.addLayer(layer_GoogleSatellite_0);
        function pop_Simplificado_1(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Región</th>\
                        <td>' + (feature.properties['Santiago 2022-10V2_Región'] !== null ? autolinker.link(feature.properties['Santiago 2022-10V2_Región'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Comuna</th>\
                        <td>' + (feature.properties['Comuna'] !== null ? autolinker.link(feature.properties['Comuna'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Consumo Total (MWh)</th>\
                        <td>' + (feature.properties['Santiago 2022-10V2_Energia Mw'] !== null ? autolinker.link(feature.properties['Santiago 2022-10V2_Energia Mw'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Consumo Mensual (kWh)</th>\
                        <td>' + (feature.properties['Santiago 2022-10V2_Consumo_kWh_Mensual'] !== null ? autolinker.link(feature.properties['Santiago 2022-10V2_Consumo_kWh_Mensual'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td class="visible-with-data" id="Santiago 2022-10V2_Precio_kWh"colspan="2"><strong>$ (kWh)</strong><br />' + (feature.properties['Santiago 2022-10V2_Precio_kWh'] !== null ? autolinker.link(feature.properties['Santiago 2022-10V2_Precio_kWh'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Simplificado_1_0() {
            return {
                pane: 'pane_Simplificado_1',
                opacity: 1,
                color: 'rgba(175,220,158,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 3.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(137,184,55,0.34901960784313724)',
                interactive: true,
            }
        }
        map.createPane('pane_Simplificado_1');
        map.getPane('pane_Simplificado_1').style.zIndex = 401;
        map.getPane('pane_Simplificado_1').style['mix-blend-mode'] = 'normal';
        var layer_Simplificado_1 = new L.geoJson(json_Simplificado_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Simplificado_1',
            layerName: 'layer_Simplificado_1',
            pane: 'pane_Simplificado_1',
            onEachFeature: pop_Simplificado_1,
            style: style_Simplificado_1_0,
        });
        bounds_group.addLayer(layer_Simplificado_1);
        map.addLayer(layer_Simplificado_1);
        var osmGeocoder = new L.Control.Geocoder({
            collapsed: true,
            position: 'topleft',
            text: 'Search',
            title: 'Testing'
        }).addTo(map);
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0]
        .className += ' fa fa-search';
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0]
        .title += 'Search for a place';
        var overlaysTree = [
            {label: '<img src="legend/Simplificado_1.png" /> Simplificado', layer: layer_Simplificado_1},
            {label: "Google Satellite", layer: layer_GoogleSatellite_0},]
        var lay = L.control.layers.tree(null, overlaysTree,{
            //namedToggle: true,
            //selectorBack: false,
            //closedSymbol: '&#8862; &#x1f5c0;',
            //openedSymbol: '&#8863; &#x1f5c1;',
            //collapseAll: 'Collapse all',
            //expandAll: 'Expand all',
            collapsed: true,
        });
        lay.addTo(map);
        setBounds();
        map.addControl(new L.Control.Search({
            layer: layer_Simplificado_1,
            initial: false,
            hideMarkerOnCollapse: true,
            propertyName: 'Comuna'}));
        document.getElementsByClassName('search-button')[0].className +=
         ' fa fa-binoculars';
        var mapDiv = document.getElementById('map');
        var row = document.createElement('div');
        row.className="row";
        row.id="all";
        row.style.height = "100%";
        var col1 = document.createElement('div');
        col1.className="col9";
        col1.id = "mapWindow";
        col1.style.height = "100%";
        col1.style.width = "85%";
        col1.style.display = "inline-block";
        var col2 = document.createElement('div');
        col2.className="col3";
        col2.id = "menu";
        col2.style.height = "99%";
        col2.style.display = "inline-block";
        mapDiv.parentNode.insertBefore(row, mapDiv);
        document.getElementById("all").appendChild(col1);
        document.getElementById("all").appendChild(col2);
        col1.appendChild(mapDiv)
        var Filters = {"Comuna": "str","Region": "str"};
        function filterFunc() {
          map.eachLayer(function(lyr){
          if ("options" in lyr && "dataVar" in lyr["options"]){
            features = this[lyr["options"]["dataVar"]].features.slice(0);
            try{
              for (key in Filters){
                keyS = key.replace(/[^a-zA-Z0-9_]/g, "")
                if (Filters[key] == "str" || Filters[key] == "bool"){
                  var selection = [];
                  var options = document.getElementById("sel_" + keyS).options
                  for (var i=0; i < options.length; i++) {
                    if (options[i].selected) selection.push(options[i].value);
                  }
                    try{
                      if (key in features[0].properties){
                        for (i = features.length - 1;
                          i >= 0; --i){
                          if (selection.indexOf(
                          features[i].properties[key])<0
                          && selection.length>0) {
                          features.splice(i,1);
                          }
                        }
                      }
                    } catch(err){
                  }
                }
                if (Filters[key] == "int"){
                  sliderVals =  document.getElementById(
                    "div_" + keyS).noUiSlider.get();
                  try{
                    if (key in features[0].properties){
                    for (i = features.length - 1; i >= 0; --i){
                      if (parseInt(features[i].properties[key])
                          < sliderVals[0]
                          || parseInt(features[i].properties[key])
                          > sliderVals[1]){
                            features.splice(i,1);
                          }
                        }
                      }
                    } catch(err){
                    }
                  }
                if (Filters[key] == "real"){
                  sliderVals =  document.getElementById(
                    "div_" + keyS).noUiSlider.get();
                  try{
                    if (key in features[0].properties){
                    for (i = features.length - 1; i >= 0; --i){
                      if (features[i].properties[key]
                          < sliderVals[0]
                          || features[i].properties[key]
                          > sliderVals[1]){
                            features.splice(i,1);
                          }
                        }
                      }
                    } catch(err){
                    }
                  }
                if (Filters[key] == "date"
                  || Filters[key] == "datetime"
                  || Filters[key] == "time"){
                  try{
                    if (key in features[0].properties){
                      HTMLkey = key.replace(/[&\/\\#,+()$~%.'":*?<>{} ]/g, '');
                      startdate = document.getElementById("dat_" +
                        HTMLkey + "_date1").value.replace(" ", "T");
                      enddate = document.getElementById("dat_" +
                        HTMLkey + "_date2").value.replace(" ", "T");
                      for (i = features.length - 1; i >= 0; --i){
                        if (features[i].properties[key] < startdate
                          || features[i].properties[key] > enddate){
                          features.splice(i,1);
                        }
                      }
                    }
                  } catch(err){
                  }
                }
              }
            } catch(err){
            }
          this[lyr["options"]["layerName"]].clearLayers();
          this[lyr["options"]["layerName"]].addData(features);
          }
          })
        }
            document.getElementById("menu").appendChild(
                document.createElement("div"));
            var div_Comuna = document.createElement('div');
            div_Comuna.id = "div_Comuna";
            div_Comuna.className= "filterselect";
            document.getElementById("menu").appendChild(div_Comuna);
            sel_Comuna = document.createElement('select');
            sel_Comuna.multiple = true;
            sel_Comuna.size = 20;
            sel_Comuna.id = "sel_Comuna";
            var Comuna_options_str = "<option value='' unselected></option>";
            sel_Comuna.onchange = function(){filterFunc()};
            Comuna_options_str  += '<option value="Algarrobo">Algarrobo</option>';
            Comuna_options_str  += '<option value="Alhué">Alhué</option>';
            Comuna_options_str  += '<option value="Alto Biobío">Alto Biobío</option>';
            Comuna_options_str  += '<option value="Alto Hospicio">Alto Hospicio</option>';
            Comuna_options_str  += '<option value="Alto del Carmen">Alto del Carmen</option>';
            Comuna_options_str  += '<option value="Ancud">Ancud</option>';
            Comuna_options_str  += '<option value="Andacollo">Andacollo</option>';
            Comuna_options_str  += '<option value="Angol">Angol</option>';
            Comuna_options_str  += '<option value="Antofagasta">Antofagasta</option>';
            Comuna_options_str  += '<option value="Antuco">Antuco</option>';
            Comuna_options_str  += '<option value="Arauco">Arauco</option>';
            Comuna_options_str  += '<option value="Arica">Arica</option>';
            Comuna_options_str  += '<option value="Aysén">Aysén</option>';
            Comuna_options_str  += '<option value="Buin">Buin</option>';
            Comuna_options_str  += '<option value="Bulnes">Bulnes</option>';
            Comuna_options_str  += '<option value="Cabildo">Cabildo</option>';
            Comuna_options_str  += '<option value="Cabo de Hornos">Cabo de Hornos</option>';
            Comuna_options_str  += '<option value="Cabrero">Cabrero</option>';
            Comuna_options_str  += '<option value="Calama">Calama</option>';
            Comuna_options_str  += '<option value="Calbuco">Calbuco</option>';
            Comuna_options_str  += '<option value="Caldera">Caldera</option>';
            Comuna_options_str  += '<option value="Calera">Calera</option>';
            Comuna_options_str  += '<option value="Calera de Tango">Calera de Tango</option>';
            Comuna_options_str  += '<option value="Calle Larga">Calle Larga</option>';
            Comuna_options_str  += '<option value="Camarones">Camarones</option>';
            Comuna_options_str  += '<option value="Camiña">Camiña</option>';
            Comuna_options_str  += '<option value="Canela">Canela</option>';
            Comuna_options_str  += '<option value="Carahue">Carahue</option>';
            Comuna_options_str  += '<option value="Cartagena">Cartagena</option>';
            Comuna_options_str  += '<option value="Casablanca">Casablanca</option>';
            Comuna_options_str  += '<option value="Castro">Castro</option>';
            Comuna_options_str  += '<option value="Catemu">Catemu</option>';
            Comuna_options_str  += '<option value="Cauquenes">Cauquenes</option>';
            Comuna_options_str  += '<option value="Cañete">Cañete</option>';
            Comuna_options_str  += '<option value="Cerrillos">Cerrillos</option>';
            Comuna_options_str  += '<option value="Cerro Navia">Cerro Navia</option>';
            Comuna_options_str  += '<option value="Chaitén">Chaitén</option>';
            Comuna_options_str  += '<option value="Chanco">Chanco</option>';
            Comuna_options_str  += '<option value="Chañaral">Chañaral</option>';
            Comuna_options_str  += '<option value="Chiguayante">Chiguayante</option>';
            Comuna_options_str  += '<option value="Chile Chico">Chile Chico</option>';
            Comuna_options_str  += '<option value="Chillán">Chillán</option>';
            Comuna_options_str  += '<option value="Chillán Viejo">Chillán Viejo</option>';
            Comuna_options_str  += '<option value="Chimbarongo">Chimbarongo</option>';
            Comuna_options_str  += '<option value="Cholchol">Cholchol</option>';
            Comuna_options_str  += '<option value="Chonchi">Chonchi</option>';
            Comuna_options_str  += '<option value="Chépica">Chépica</option>';
            Comuna_options_str  += '<option value="Cisnes">Cisnes</option>';
            Comuna_options_str  += '<option value="Cobquecura">Cobquecura</option>';
            Comuna_options_str  += '<option value="Cochamó">Cochamó</option>';
            Comuna_options_str  += '<option value="Cochrane">Cochrane</option>';
            Comuna_options_str  += '<option value="Codegua">Codegua</option>';
            Comuna_options_str  += '<option value="Coelemu">Coelemu</option>';
            Comuna_options_str  += '<option value="Coihueco">Coihueco</option>';
            Comuna_options_str  += '<option value="Coinco">Coinco</option>';
            Comuna_options_str  += '<option value="Colbún">Colbún</option>';
            Comuna_options_str  += '<option value="Colchane">Colchane</option>';
            Comuna_options_str  += '<option value="Colina">Colina</option>';
            Comuna_options_str  += '<option value="Collipulli">Collipulli</option>';
            Comuna_options_str  += '<option value="Coltauco">Coltauco</option>';
            Comuna_options_str  += '<option value="Combarbalá">Combarbalá</option>';
            Comuna_options_str  += '<option value="Concepción">Concepción</option>';
            Comuna_options_str  += '<option value="Conchalí">Conchalí</option>';
            Comuna_options_str  += '<option value="Concón">Concón</option>';
            Comuna_options_str  += '<option value="Constitución">Constitución</option>';
            Comuna_options_str  += '<option value="Contulmo">Contulmo</option>';
            Comuna_options_str  += '<option value="Copiapó">Copiapó</option>';
            Comuna_options_str  += '<option value="Coquimbo">Coquimbo</option>';
            Comuna_options_str  += '<option value="Coronel">Coronel</option>';
            Comuna_options_str  += '<option value="Corral">Corral</option>';
            Comuna_options_str  += '<option value="Coyhaique">Coyhaique</option>';
            Comuna_options_str  += '<option value="Cunco">Cunco</option>';
            Comuna_options_str  += '<option value="Curacautín">Curacautín</option>';
            Comuna_options_str  += '<option value="Curacaví">Curacaví</option>';
            Comuna_options_str  += '<option value="Curaco de Vélez">Curaco de Vélez</option>';
            Comuna_options_str  += '<option value="Curanilahue">Curanilahue</option>';
            Comuna_options_str  += '<option value="Curarrehue">Curarrehue</option>';
            Comuna_options_str  += '<option value="Curepto">Curepto</option>';
            Comuna_options_str  += '<option value="Curicó">Curicó</option>';
            Comuna_options_str  += '<option value="Dalcahue">Dalcahue</option>';
            Comuna_options_str  += '<option value="Diego de Almagro">Diego de Almagro</option>';
            Comuna_options_str  += '<option value="Doñihue">Doñihue</option>';
            Comuna_options_str  += '<option value="El Bosque">El Bosque</option>';
            Comuna_options_str  += '<option value="El Carmen">El Carmen</option>';
            Comuna_options_str  += '<option value="El Monte">El Monte</option>';
            Comuna_options_str  += '<option value="El Quisco">El Quisco</option>';
            Comuna_options_str  += '<option value="El Tabo">El Tabo</option>';
            Comuna_options_str  += '<option value="Empedrado">Empedrado</option>';
            Comuna_options_str  += '<option value="Ercilla">Ercilla</option>';
            Comuna_options_str  += '<option value="Estación Central">Estación Central</option>';
            Comuna_options_str  += '<option value="Florida">Florida</option>';
            Comuna_options_str  += '<option value="Freire">Freire</option>';
            Comuna_options_str  += '<option value="Freirina">Freirina</option>';
            Comuna_options_str  += '<option value="Fresia">Fresia</option>';
            Comuna_options_str  += '<option value="Frutillar">Frutillar</option>';
            Comuna_options_str  += '<option value="Futaleufú">Futaleufú</option>';
            Comuna_options_str  += '<option value="Futrono">Futrono</option>';
            Comuna_options_str  += '<option value="Galvarino">Galvarino</option>';
            Comuna_options_str  += '<option value="General Lagos">General Lagos</option>';
            Comuna_options_str  += '<option value="Gorbea">Gorbea</option>';
            Comuna_options_str  += '<option value="Graneros">Graneros</option>';
            Comuna_options_str  += '<option value="Guaitecas">Guaitecas</option>';
            Comuna_options_str  += '<option value="Hijuelas">Hijuelas</option>';
            Comuna_options_str  += '<option value="Hualaihué">Hualaihué</option>';
            Comuna_options_str  += '<option value="Hualañé">Hualañé</option>';
            Comuna_options_str  += '<option value="Hualpén">Hualpén</option>';
            Comuna_options_str  += '<option value="Hualqui">Hualqui</option>';
            Comuna_options_str  += '<option value="Huara">Huara</option>';
            Comuna_options_str  += '<option value="Huasco">Huasco</option>';
            Comuna_options_str  += '<option value="Huechuraba">Huechuraba</option>';
            Comuna_options_str  += '<option value="Illapel">Illapel</option>';
            Comuna_options_str  += '<option value="Independencia">Independencia</option>';
            Comuna_options_str  += '<option value="Iquique">Iquique</option>';
            Comuna_options_str  += '<option value="Isla de Maipo">Isla de Maipo</option>';
            Comuna_options_str  += '<option value="Isla de Pascua">Isla de Pascua</option>';
            Comuna_options_str  += '<option value="Juan Fernández">Juan Fernández</option>';
            Comuna_options_str  += '<option value="La Cisterna">La Cisterna</option>';
            Comuna_options_str  += '<option value="La Cruz">La Cruz</option>';
            Comuna_options_str  += '<option value="La Estrella">La Estrella</option>';
            Comuna_options_str  += '<option value="La Florida">La Florida</option>';
            Comuna_options_str  += '<option value="La Granja">La Granja</option>';
            Comuna_options_str  += '<option value="La Higuera">La Higuera</option>';
            Comuna_options_str  += '<option value="La Ligua">La Ligua</option>';
            Comuna_options_str  += '<option value="La Pintana">La Pintana</option>';
            Comuna_options_str  += '<option value="La Reina">La Reina</option>';
            Comuna_options_str  += '<option value="La Serena">La Serena</option>';
            Comuna_options_str  += '<option value="La Unión">La Unión</option>';
            Comuna_options_str  += '<option value="Lago Ranco">Lago Ranco</option>';
            Comuna_options_str  += '<option value="Lago Verde">Lago Verde</option>';
            Comuna_options_str  += '<option value="Laguna Blanca">Laguna Blanca</option>';
            Comuna_options_str  += '<option value="Laja">Laja</option>';
            Comuna_options_str  += '<option value="Lampa">Lampa</option>';
            Comuna_options_str  += '<option value="Lanco">Lanco</option>';
            Comuna_options_str  += '<option value="Las Cabras">Las Cabras</option>';
            Comuna_options_str  += '<option value="Las Condes">Las Condes</option>';
            Comuna_options_str  += '<option value="Lautaro">Lautaro</option>';
            Comuna_options_str  += '<option value="Lebu">Lebu</option>';
            Comuna_options_str  += '<option value="Licantén">Licantén</option>';
            Comuna_options_str  += '<option value="Limache">Limache</option>';
            Comuna_options_str  += '<option value="Linares">Linares</option>';
            Comuna_options_str  += '<option value="Litueche">Litueche</option>';
            Comuna_options_str  += '<option value="Llaillay">Llaillay</option>';
            Comuna_options_str  += '<option value="Llanquihue">Llanquihue</option>';
            Comuna_options_str  += '<option value="Lo Barnechea">Lo Barnechea</option>';
            Comuna_options_str  += '<option value="Lo Espejo">Lo Espejo</option>';
            Comuna_options_str  += '<option value="Lo Prado">Lo Prado</option>';
            Comuna_options_str  += '<option value="Lolol">Lolol</option>';
            Comuna_options_str  += '<option value="Loncoche">Loncoche</option>';
            Comuna_options_str  += '<option value="Longaví">Longaví</option>';
            Comuna_options_str  += '<option value="Lonquimay">Lonquimay</option>';
            Comuna_options_str  += '<option value="Los Alamos">Los Alamos</option>';
            Comuna_options_str  += '<option value="Los Andes">Los Andes</option>';
            Comuna_options_str  += '<option value="Los Angeles">Los Angeles</option>';
            Comuna_options_str  += '<option value="Los Lagos">Los Lagos</option>';
            Comuna_options_str  += '<option value="Los Muermos">Los Muermos</option>';
            Comuna_options_str  += '<option value="Los Sauces">Los Sauces</option>';
            Comuna_options_str  += '<option value="Los Vilos">Los Vilos</option>';
            Comuna_options_str  += '<option value="Lota">Lota</option>';
            Comuna_options_str  += '<option value="Lumaco">Lumaco</option>';
            Comuna_options_str  += '<option value="Machalí">Machalí</option>';
            Comuna_options_str  += '<option value="Macul">Macul</option>';
            Comuna_options_str  += '<option value="Maipú">Maipú</option>';
            Comuna_options_str  += '<option value="Malloa">Malloa</option>';
            Comuna_options_str  += '<option value="Marchigüe">Marchigüe</option>';
            Comuna_options_str  += '<option value="Mariquina">Mariquina</option>';
            Comuna_options_str  += '<option value="María Elena">María Elena</option>';
            Comuna_options_str  += '<option value="María Pinto">María Pinto</option>';
            Comuna_options_str  += '<option value="Maule">Maule</option>';
            Comuna_options_str  += '<option value="Maullín">Maullín</option>';
            Comuna_options_str  += '<option value="Mejillones">Mejillones</option>';
            Comuna_options_str  += '<option value="Melipeuco">Melipeuco</option>';
            Comuna_options_str  += '<option value="Melipilla">Melipilla</option>';
            Comuna_options_str  += '<option value="Molina">Molina</option>';
            Comuna_options_str  += '<option value="Monte Patria">Monte Patria</option>';
            Comuna_options_str  += '<option value="Mostazal">Mostazal</option>';
            Comuna_options_str  += '<option value="Mulchén">Mulchén</option>';
            Comuna_options_str  += '<option value="Máfil">Máfil</option>';
            Comuna_options_str  += '<option value="Nacimiento">Nacimiento</option>';
            Comuna_options_str  += '<option value="Nancagua">Nancagua</option>';
            Comuna_options_str  += '<option value="Natales">Natales</option>';
            Comuna_options_str  += '<option value="Navidad">Navidad</option>';
            Comuna_options_str  += '<option value="Negrete">Negrete</option>';
            Comuna_options_str  += '<option value="Ninhue">Ninhue</option>';
            Comuna_options_str  += '<option value="Nogales">Nogales</option>';
            Comuna_options_str  += '<option value="Nueva Imperial">Nueva Imperial</option>';
            Comuna_options_str  += '<option value="O&apos;Higgins">O&apos;Higgins</option>';
            Comuna_options_str  += '<option value="Olivar">Olivar</option>';
            Comuna_options_str  += '<option value="Ollagüe">Ollagüe</option>';
            Comuna_options_str  += '<option value="Olmué">Olmué</option>';
            Comuna_options_str  += '<option value="Osorno">Osorno</option>';
            Comuna_options_str  += '<option value="Ovalle">Ovalle</option>';
            Comuna_options_str  += '<option value="Padre Hurtado">Padre Hurtado</option>';
            Comuna_options_str  += '<option value="Padre Las Casas">Padre Las Casas</option>';
            Comuna_options_str  += '<option value="Paihuano">Paihuano</option>';
            Comuna_options_str  += '<option value="Paillaco">Paillaco</option>';
            Comuna_options_str  += '<option value="Paine">Paine</option>';
            Comuna_options_str  += '<option value="Palena">Palena</option>';
            Comuna_options_str  += '<option value="Palmilla">Palmilla</option>';
            Comuna_options_str  += '<option value="Panguipulli">Panguipulli</option>';
            Comuna_options_str  += '<option value="Panquehue">Panquehue</option>';
            Comuna_options_str  += '<option value="Papudo">Papudo</option>';
            Comuna_options_str  += '<option value="Paredones">Paredones</option>';
            Comuna_options_str  += '<option value="Parral">Parral</option>';
            Comuna_options_str  += '<option value="Pedro Aguirre Cerda">Pedro Aguirre Cerda</option>';
            Comuna_options_str  += '<option value="Pelarco">Pelarco</option>';
            Comuna_options_str  += '<option value="Pelluhue">Pelluhue</option>';
            Comuna_options_str  += '<option value="Pemuco">Pemuco</option>';
            Comuna_options_str  += '<option value="Pencahue">Pencahue</option>';
            Comuna_options_str  += '<option value="Penco">Penco</option>';
            Comuna_options_str  += '<option value="Peralillo">Peralillo</option>';
            Comuna_options_str  += '<option value="Perquenco">Perquenco</option>';
            Comuna_options_str  += '<option value="Petorca">Petorca</option>';
            Comuna_options_str  += '<option value="Peumo">Peumo</option>';
            Comuna_options_str  += '<option value="Peñaflor">Peñaflor</option>';
            Comuna_options_str  += '<option value="Peñalolén">Peñalolén</option>';
            Comuna_options_str  += '<option value="Pica">Pica</option>';
            Comuna_options_str  += '<option value="Pichidegua">Pichidegua</option>';
            Comuna_options_str  += '<option value="Pichilemu">Pichilemu</option>';
            Comuna_options_str  += '<option value="Pinto">Pinto</option>';
            Comuna_options_str  += '<option value="Pirque">Pirque</option>';
            Comuna_options_str  += '<option value="Pitrufquén">Pitrufquén</option>';
            Comuna_options_str  += '<option value="Placilla">Placilla</option>';
            Comuna_options_str  += '<option value="Portezuelo">Portezuelo</option>';
            Comuna_options_str  += '<option value="Porvenir">Porvenir</option>';
            Comuna_options_str  += '<option value="Pozo Almonte">Pozo Almonte</option>';
            Comuna_options_str  += '<option value="Primavera">Primavera</option>';
            Comuna_options_str  += '<option value="Providencia">Providencia</option>';
            Comuna_options_str  += '<option value="Puchuncaví">Puchuncaví</option>';
            Comuna_options_str  += '<option value="Pucón">Pucón</option>';
            Comuna_options_str  += '<option value="Pudahuel">Pudahuel</option>';
            Comuna_options_str  += '<option value="Puente Alto">Puente Alto</option>';
            Comuna_options_str  += '<option value="Puerto Montt">Puerto Montt</option>';
            Comuna_options_str  += '<option value="Puerto Octay">Puerto Octay</option>';
            Comuna_options_str  += '<option value="Puerto Varas">Puerto Varas</option>';
            Comuna_options_str  += '<option value="Pumanque">Pumanque</option>';
            Comuna_options_str  += '<option value="Punitaqui">Punitaqui</option>';
            Comuna_options_str  += '<option value="Punta Arenas">Punta Arenas</option>';
            Comuna_options_str  += '<option value="Puqueldón">Puqueldón</option>';
            Comuna_options_str  += '<option value="Purranque">Purranque</option>';
            Comuna_options_str  += '<option value="Purén">Purén</option>';
            Comuna_options_str  += '<option value="Putaendo">Putaendo</option>';
            Comuna_options_str  += '<option value="Putre">Putre</option>';
            Comuna_options_str  += '<option value="Puyehue">Puyehue</option>';
            Comuna_options_str  += '<option value="Queilén">Queilén</option>';
            Comuna_options_str  += '<option value="Quellón">Quellón</option>';
            Comuna_options_str  += '<option value="Quemchi">Quemchi</option>';
            Comuna_options_str  += '<option value="Quilaco">Quilaco</option>';
            Comuna_options_str  += '<option value="Quilicura">Quilicura</option>';
            Comuna_options_str  += '<option value="Quilleco">Quilleco</option>';
            Comuna_options_str  += '<option value="Quillota">Quillota</option>';
            Comuna_options_str  += '<option value="Quillón">Quillón</option>';
            Comuna_options_str  += '<option value="Quilpué">Quilpué</option>';
            Comuna_options_str  += '<option value="Quinchao">Quinchao</option>';
            Comuna_options_str  += '<option value="Quinta Normal">Quinta Normal</option>';
            Comuna_options_str  += '<option value="Quinta de Tilcoco">Quinta de Tilcoco</option>';
            Comuna_options_str  += '<option value="Quintero">Quintero</option>';
            Comuna_options_str  += '<option value="Quirihue">Quirihue</option>';
            Comuna_options_str  += '<option value="Rancagua">Rancagua</option>';
            Comuna_options_str  += '<option value="Ranquil">Ranquil</option>';
            Comuna_options_str  += '<option value="Rauco">Rauco</option>';
            Comuna_options_str  += '<option value="Recoleta">Recoleta</option>';
            Comuna_options_str  += '<option value="Renaico">Renaico</option>';
            Comuna_options_str  += '<option value="Renca">Renca</option>';
            Comuna_options_str  += '<option value="Rengo">Rengo</option>';
            Comuna_options_str  += '<option value="Requínoa">Requínoa</option>';
            Comuna_options_str  += '<option value="Retiro">Retiro</option>';
            Comuna_options_str  += '<option value="Rinconada">Rinconada</option>';
            Comuna_options_str  += '<option value="Romeral">Romeral</option>';
            Comuna_options_str  += '<option value="Río Bueno">Río Bueno</option>';
            Comuna_options_str  += '<option value="Río Claro">Río Claro</option>';
            Comuna_options_str  += '<option value="Río Hurtado">Río Hurtado</option>';
            Comuna_options_str  += '<option value="Río Ibáñez">Río Ibáñez</option>';
            Comuna_options_str  += '<option value="Río Negro">Río Negro</option>';
            Comuna_options_str  += '<option value="Río Verde">Río Verde</option>';
            Comuna_options_str  += '<option value="Saavedra">Saavedra</option>';
            Comuna_options_str  += '<option value="Sagrada Familia">Sagrada Familia</option>';
            Comuna_options_str  += '<option value="Salamanca">Salamanca</option>';
            Comuna_options_str  += '<option value="San Antonio">San Antonio</option>';
            Comuna_options_str  += '<option value="San Bernardo">San Bernardo</option>';
            Comuna_options_str  += '<option value="San Carlos">San Carlos</option>';
            Comuna_options_str  += '<option value="San Clemente">San Clemente</option>';
            Comuna_options_str  += '<option value="San Esteban">San Esteban</option>';
            Comuna_options_str  += '<option value="San Fabián">San Fabián</option>';
            Comuna_options_str  += '<option value="San Felipe">San Felipe</option>';
            Comuna_options_str  += '<option value="San Fernando">San Fernando</option>';
            Comuna_options_str  += '<option value="San Gregorio">San Gregorio</option>';
            Comuna_options_str  += '<option value="San Ignacio">San Ignacio</option>';
            Comuna_options_str  += '<option value="San Javier">San Javier</option>';
            Comuna_options_str  += '<option value="San Joaquín">San Joaquín</option>';
            Comuna_options_str  += '<option value="San José de Maipo">San José de Maipo</option>';
            Comuna_options_str  += '<option value="San Juan de la Costa">San Juan de la Costa</option>';
            Comuna_options_str  += '<option value="San Miguel">San Miguel</option>';
            Comuna_options_str  += '<option value="San Nicolás">San Nicolás</option>';
            Comuna_options_str  += '<option value="San Pablo">San Pablo</option>';
            Comuna_options_str  += '<option value="San Pedro">San Pedro</option>';
            Comuna_options_str  += '<option value="San Pedro de Atacama">San Pedro de Atacama</option>';
            Comuna_options_str  += '<option value="San Pedro de la Paz">San Pedro de la Paz</option>';
            Comuna_options_str  += '<option value="San Rafael">San Rafael</option>';
            Comuna_options_str  += '<option value="San Ramón">San Ramón</option>';
            Comuna_options_str  += '<option value="San Rosendo">San Rosendo</option>';
            Comuna_options_str  += '<option value="San Vicente">San Vicente</option>';
            Comuna_options_str  += '<option value="Santa Bárbara">Santa Bárbara</option>';
            Comuna_options_str  += '<option value="Santa Cruz">Santa Cruz</option>';
            Comuna_options_str  += '<option value="Santa Juana">Santa Juana</option>';
            Comuna_options_str  += '<option value="Santa María">Santa María</option>';
            Comuna_options_str  += '<option value="Santiago">Santiago</option>';
            Comuna_options_str  += '<option value="Santo Domingo">Santo Domingo</option>';
            Comuna_options_str  += '<option value="Sierra Gorda">Sierra Gorda</option>';
            Comuna_options_str  += '<option value="Talagante">Talagante</option>';
            Comuna_options_str  += '<option value="Talca">Talca</option>';
            Comuna_options_str  += '<option value="Talcahuano">Talcahuano</option>';
            Comuna_options_str  += '<option value="Taltal">Taltal</option>';
            Comuna_options_str  += '<option value="Temuco">Temuco</option>';
            Comuna_options_str  += '<option value="Teno">Teno</option>';
            Comuna_options_str  += '<option value="Teodoro Schmidt">Teodoro Schmidt</option>';
            Comuna_options_str  += '<option value="Tierra Amarilla">Tierra Amarilla</option>';
            Comuna_options_str  += '<option value="Tiltil">Tiltil</option>';
            Comuna_options_str  += '<option value="Timaukel">Timaukel</option>';
            Comuna_options_str  += '<option value="Tirúa">Tirúa</option>';
            Comuna_options_str  += '<option value="Tocopilla">Tocopilla</option>';
            Comuna_options_str  += '<option value="Toltén">Toltén</option>';
            Comuna_options_str  += '<option value="Tomé">Tomé</option>';
            Comuna_options_str  += '<option value="Torres del Paine">Torres del Paine</option>';
            Comuna_options_str  += '<option value="Tortel">Tortel</option>';
            Comuna_options_str  += '<option value="Traiguén">Traiguén</option>';
            Comuna_options_str  += '<option value="Treguaco">Treguaco</option>';
            Comuna_options_str  += '<option value="Tucapel">Tucapel</option>';
            Comuna_options_str  += '<option value="Valdivia">Valdivia</option>';
            Comuna_options_str  += '<option value="Vallenar">Vallenar</option>';
            Comuna_options_str  += '<option value="Valparaíso">Valparaíso</option>';
            Comuna_options_str  += '<option value="Vichuquén">Vichuquén</option>';
            Comuna_options_str  += '<option value="Victoria">Victoria</option>';
            Comuna_options_str  += '<option value="Vicuña">Vicuña</option>';
            Comuna_options_str  += '<option value="Vilcún">Vilcún</option>';
            Comuna_options_str  += '<option value="Villa Alegre">Villa Alegre</option>';
            Comuna_options_str  += '<option value="Villa Alemana">Villa Alemana</option>';
            Comuna_options_str  += '<option value="Villarrica">Villarrica</option>';
            Comuna_options_str  += '<option value="Vitacura">Vitacura</option>';
            Comuna_options_str  += '<option value="Viña del Mar">Viña del Mar</option>';
            Comuna_options_str  += '<option value="Yerbas Buenas">Yerbas Buenas</option>';
            Comuna_options_str  += '<option value="Yumbel">Yumbel</option>';
            Comuna_options_str  += '<option value="Yungay">Yungay</option>';
            Comuna_options_str  += '<option value="Zapallar">Zapallar</option>';
            Comuna_options_str  += '<option value="Zona sin demarcar">Zona sin demarcar</option>';
            Comuna_options_str  += '<option value="Ñiquén">Ñiquén</option>';
            Comuna_options_str  += '<option value="Ñuñoa">Ñuñoa</option>';
            sel_Comuna.innerHTML = Comuna_options_str;
            div_Comuna.appendChild(sel_Comuna);
            var lab_Comuna = document.createElement('div');
            lab_Comuna.innerHTML = 'Comuna';
            lab_Comuna.className = 'filterlabel';
            div_Comuna.appendChild(lab_Comuna);
            var reset_Comuna = document.createElement('div');
            reset_Comuna.innerHTML = 'Limpiar filtro';
            reset_Comuna.className = 'filterlabel';
            reset_Comuna.onclick = function() {
                var options = document.getElementById("sel_Comuna").options;
                for (var i=0; i < options.length; i++) {
                    options[i].selected = false;
                }
                filterFunc();
            };
            div_Comuna.appendChild(reset_Comuna);
            document.getElementById("menu").appendChild(
                document.createElement("div"));
            var div_Region = document.createElement('div');
            div_Region.id = "div_Region";
            div_Region.className= "filterselect";
            document.getElementById("menu").appendChild(div_Region);
            sel_Region = document.createElement('select');
            sel_Region.multiple = true;
            sel_Region.size = 20;
            sel_Region.id = "sel_Region";
            var Region_options_str = "<option value='' unselected></option>";
            sel_Region.onchange = function(){filterFunc()};
            Region_options_str  += '<option value="Región Metropolitana de Santiago">Región Metropolitana de Santiago</option>';
            Region_options_str  += '<option value="Región de Antofagasta">Región de Antofagasta</option>';
            Region_options_str  += '<option value="Región de Arica y Parinacota">Región de Arica y Parinacota</option>';
            Region_options_str  += '<option value="Región de Atacama">Región de Atacama</option>';
            Region_options_str  += '<option value="Región de Aysén del Gral.Ibañez del Campo">Región de Aysén del Gral.Ibañez del Campo</option>';
            Region_options_str  += '<option value="Región de Coquimbo">Región de Coquimbo</option>';
            Region_options_str  += '<option value="Región de La Araucanía">Región de La Araucanía</option>';
            Region_options_str  += '<option value="Región de Los Lagos">Región de Los Lagos</option>';
            Region_options_str  += '<option value="Región de Los Ríos">Región de Los Ríos</option>';
            Region_options_str  += '<option value="Región de Magallanes y Antártica Chilena">Región de Magallanes y Antártica Chilena</option>';
            Region_options_str  += '<option value="Región de Tarapacá">Región de Tarapacá</option>';
            Region_options_str  += '<option value="Región de Valparaíso">Región de Valparaíso</option>';
            Region_options_str  += '<option value="Región de Ñuble">Región de Ñuble</option>';
            Region_options_str  += '<option value="Región del Bío-Bío">Región del Bío-Bío</option>';
            Region_options_str  += '<option value="Región del Libertador Bernardo O&apos;Higgins">Región del Libertador Bernardo O&apos;Higgins</option>';
            Region_options_str  += '<option value="Región del Maule">Región del Maule</option>';
            sel_Region.innerHTML = Region_options_str;
            div_Region.appendChild(sel_Region);
            var lab_Region = document.createElement('div');
            lab_Region.innerHTML = 'Región';
            lab_Region.className = 'filterlabel';
            div_Region.appendChild(lab_Region);
            var reset_Region = document.createElement('div');
            reset_Region.innerHTML = 'Limpiar filtro';
            reset_Region.className = 'filterlabel';
            reset_Region.onclick = function() {
                var options = document.getElementById("sel_Region").options;
                for (var i=0; i < options.length; i++) {
                    options[i].selected = false;
                }
                filterFunc();
            };
            div_Region.appendChild(reset_Region);
              // Función para abrir el modal con la calculadora
        function openCalculator() {
            document.getElementById('calculatorLightbox').style.display = "block";
       }

       // Función para cerrar el modal
       function closeCalculator() {
            document.getElementById('calculatorLightbox').style.display = "none";
          }
        </script>
    </body>
</html>
